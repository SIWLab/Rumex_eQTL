---
title: "plink"
author: "Meng"
date: "2024-05-20"
output: html_document
---

```{r setup, include=FALSE}
library(ggplot2)
library(dplyr)
library(tidyr)
library(stringr)
library(patchwork)
data <- "/Users/yuanmeng/Library/CloudStorage/OneDrive-UniversityofToronto/Manuscripts/rumex_eqtl/plink/"
```


# PCA
check for outliers
```{r}
pca <- read.table(paste0(data,"sex.eigenvec"))
eigenval <- scan(paste0(data,"sex.eigenval"))
# sort out the pca data
# remove nuisance column
pca <- pca[,-1]
# set names
names(pca)[1] <- "ind"
names(pca)[2:ncol(pca)] <- paste0("PC", 1:(ncol(pca)-1))

# sort out the individual species and pops
# spp
sex <- rep(NA, length(pca$ind))
sex[grep("F", pca$ind)] <- "female"
sex[grep("M", pca$ind)] <- "male"

pca <- data.frame(pca, sex)
```

```{r}
pve <- data.frame(PC = 1:20, pve = eigenval/sum(eigenval)*100)
cumsum(pve$pve)
# make plot
a <- ggplot(pve, aes(PC, pve)) + geom_bar(stat = "identity")
a + ylab("Percentage variance explained") + theme_light()
```
 [1]   6.360536  12.228722  17.830549  23.204612  28.529886  33.639426
 [7]  38.733896  43.690294  48.617882  53.506370  58.366490  63.156672
[13]  67.930390  72.651109  77.310217  81.927154  86.538075  91.048189
[19]  95.545798 100.000000

```{r}
# plot pca
b <- ggplot(pca, aes(PC1, PC2, col = sex)) + geom_point(size = 3)
b <- b + scale_colour_manual(values = c("red", "blue"))
b <- b + coord_equal() + theme_light()
b + xlab(paste0("PC1 (", signif(pve$pve[1], 3), "%)")) + ylab(paste0("PC2 (", signif(pve$pve[2], 3), "%)"))
```

see where the 4 outliers are and if you're removing it


## separate
```{r}
pca <- read.table(paste0(data,"MP.eigenvec"))
eigenval <- scan(paste0(data,"MP.eigenval"))

pca <- read.table(paste0(data,"ML.eigenvec"))
eigenval <- scan(paste0(data,"ML.eigenval"))

pca <- read.table(paste0(data,"FL.eigenvec"))
eigenval <- scan(paste0(data,"FL.eigenval"))
# sort out the pca data
# remove nuisance column
pca <- pca[,-1]
# set names
names(pca)[1] <- "ind"
names(pca)[2:ncol(pca)] <- paste0("PC", 1:(ncol(pca)-1))

pve <- data.frame(PC = 1:20, pve = eigenval/sum(eigenval)*100)
cumsum(pve$pve)
# make plot
a <- ggplot(pve, aes(PC, pve)) + geom_bar(stat = "identity")
a + ylab("Percentage variance explained") + theme_light()

# plot pca
ggplot(pca, aes(PC1, PC2, label=ind)) + geom_point(size = 3) + coord_equal() + theme_light() + xlab(paste0("PC1 (", signif(pve$pve[1], 3), "%)")) + ylab(paste0("PC2 (", signif(pve$pve[2], 3), "%)")) + geom_text(hjust=0, vjust=0)
```

